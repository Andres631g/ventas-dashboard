<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Tablero de Ventas Automático</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      margin: 0;
      padding: 0;
    }

    #mesas {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      padding: 20px;
    }

    .mesa {
      background-color: #222;
      padding: 15px;
      border-radius: 10px;
      border: 2px solid #444;
      font-size: 1.1em;
      transition: background-color 0.5s ease;
    }

    .mesa.destacada {
      background-color: #ffe600;
      color: black;
    }

    #efecto-venta {
      position: fixed;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: radial-gradient(circle, yellow, orange, red);
      pointer-events: none;
      display: none;
      z-index: 999;
    }

    @keyframes explosion {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: scale(5); opacity: 0; }
    }

    #nombre-vendedor {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: black;
      color: white;
      padding: 8px 16px;
      font-size: 1.2em;
      border-radius: 10px;
      display: none;
      z-index: 1000;
      box-shadow: 0 0 10px yellow;
    }
  </style>
</head>
<body>

  <div id="nombre-vendedor"></div>
  <div id="efecto-venta"></div>

  <div id="mesas">
    <!-- Aquí solo marcamos algunos de ejemplo -->
    <div class="mesa" id="mesa-pepe1">Pepe 1 - FTD: <span id="ftd-pepe1">0</span></div>
    <div class="mesa" id="mesa-pepe2">Pepe 2 - FTD: <span id="ftd-pepe2">0</span></div>
    <div class="mesa" id="mesa-pepe3">Pepe 3 - FTD: <span id="ftd-pepe3">0</span></div>
    <!-- Agrega más según lo que tengas en Sheets -->
  </div>

  <script>
    let datosAnteriores = {};

    function registrarVenta(nombre, mesaId, nuevoValor) {
      // Mostrar el nombre
      const nombreDiv = document.getElementById("nombre-vendedor");
      nombreDiv.innerText = `¡${nombre} hizo una venta!`;
      nombreDiv.style.display = "block";
      setTimeout(() => nombreDiv.style.display = "none", 3000);

      // Explosión visual
      const efecto = document.getElementById("efecto-venta");
      efecto.style.left = (window.innerWidth / 2 - 50) + "px";
      efecto.style.top = (window.innerHeight / 2 - 50) + "px";
      efecto.style.display = "block";
      efecto.style.animation = "explosion 0.6s ease-out";

      setTimeout(() => {
        efecto.style.display = "none";
        efecto.style.animation = "none";
      }, 600);

      // Destacar mesa
      const mesa = document.getElementById(mesaId);
      if (mesa) {
        mesa.classList.add("destacada");
        setTimeout(() => mesa.classList.remove("destacada"), 3000);
      }

      // Actualizar el número en pantalla
      const span = document.getElementById("ftd-" + mesaId.replace("mesa-", ""));
      if (span) {
        span.innerText = nuevoValor;
      }
    }

    function obtenerDatos() {
      Tabletop.init({
        key: 'https://docs.google.com/spreadsheets/d/1YSewMr8-0A7UZneT56udEb4TJkvX088opKq2ykAhu2c/edit#gid=0',
        simpleSheet: true,
        callback: function(data) {
          data.forEach((fila) => {
            const nombre = fila.Nombre;
            const mesaId = fila.MesaId;
            const ftd = parseInt(fila.FTD);

            // Mostrar FTD actual en pantalla
            const span = document.getElementById("ftd-" + mesaId.replace("mesa-", ""));
            if (span) {
              span.innerText = ftd;
            }

            if (
              datosAnteriores[mesaId] !== undefined &&
              ftd > datosAnteriores[mesaId]
            ) {
              registrarVenta(nombre, mesaId, ftd);
            }

            datosAnteriores[mesaId] = ftd;
          });
        }
      });
    }

    // Obtener al inicio
    obtenerDatos();

    // Verificar cada 5 segundos
    setInterval(obtenerDatos, 5000);
  </script>

</body>
</html>
